name: HLWM CI

# on: [push, pull_request]
on: push

jobs:
  build-test-current:
    # Name the Job
    name: Build and test on current ubuntu
    # Set the type of machine to run on
    runs-on: ubuntu-latest
    container: hlwm/ci:focal

    steps:
      # Checks out a copy of your repository on the ubuntu-latest machine
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Test process subst
        run: cat <(echo works) || echo Warning

      - uses: actions/cache@v1
        name: Cache ~/.ccache
        with:
          path: ~/.ccache
          key: focal-ccache

      - uses: actions/cache@v1
        name: Cache .tox-cache
        with:
          path: .tox-cache
          key: focal-tox

      - name: Build
        run: |
          ci/build.py --build-dir=build --cxx=g++-9 --cc=gcc-9 --build-type=Debug --ccache=$HOME/.ccache --compile

      - name: Test
        run: |
          ci/build.py --build-dir=build --cxx=g++-9 --cc=gcc-9 --build-type=Debug --ccache=$HOME/.ccache --run-tests

#      - name: Codecov report
#        run: |
#          bash <(wget -O - https://codecov.io/bash) -f coverage.info || echo Warning: codecov report failed
