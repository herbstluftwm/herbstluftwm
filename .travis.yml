language: python

install:
    - sudo apt-get -y -q update
    - sudo apt-get -y -q build-dep herbstluftwm
    - sudo apt-get -y -q install cmake ninja-build dzen2 xdotool

jobs:
    include:
        - name: "Ubuntu 16.04, gcc-8, Debug build, run tests"
          dist: xenial
          services: docker
          before_install:
              - docker build -t dnnr/hlwm-ci:disco - <Dockerfile.ci-disco
          script:
              - docker run --rm -v $PWD:/hlwm:ro dnnr/hlwm-ci:disco bash -c 'cd /hlwm && ./ci-check-using-std.sh && export CC=gcc-8 CXX=g++-8 && linkerfix="-fuse-ld=gold" && export LDFLAGS="$linkerfix" LDXXFLAGS="$linkerfix" && cmake -GNinja -DCMAKE_BUILD_TYPE=Debug . && ninja -v -k 10 && tox -- -n auto -v'
